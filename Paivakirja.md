# Projektin kehittämispäiväkirja
| Päivämäärä   | Aiheet   |
|-------------|-------------|
| __25.3__ | Projektin kehittäminen aloitettu. Templatena käytetään Blank templatea ja kielenä TypeScriptiä. Alun perin valittu käytettäväksi React Native Paper komponenttikirjastoa ja Bottom Tabs navigaatiota. Tutkin mahdollisuuksia expo routerin ja react nativen navigaatioiden välillä. Päädyin React Native navigaatioon, mutta tutkin vielä Expon mahdollisuuksia https://docs.expo.dev/router/migrate/from-react-navigation/ |
| __28.3__ | Tuotettu autentikaatio. Tutkittu myös mahdollisuuksia firebasen configin tallentamiseen tietoturvallisesti. Päädyin tässä vaiheessa vielä laittamaan kaikki config tiedot .env:iin, joka on gitignoressa. Mikäli tiedoille löytyy sopiva paikka ja esimerkiksi sattuisinkin vaikka käyttämään esimerkiksi EAS buildia, tulen tähän palaamaan. Kuitenkin tässä vaiheessa arkaluontoisia tietoja ei ole järkevää laittaa GitHubiin, joten siksi työskennellään public env variableilla.<br><br> Aion kirjautumisessa käyttää contextia sillä koodista tulee siistimpää, sitä on helpompaa lukea ja ymmärtää. Tämän lisäksi tilanhallinta helpompaa. Sain tästä videosta hyvin vinkkejä: https://www.youtube.com/watch?v=9NZwiQAye1g&ab_channel=CleverProgrammer. Päätin tehdä useAuthista custom Hookin modulaarisuuden säilyttämiseksi. Löysin apua tästä videosta contextin, erityisesti authcontextproviderin toimintaan ja sain ongelmani ratkaistua seuraamalla tutoriaalia: https://www.youtube.com/watch?v=x62aBvnRCKw&t=1072s&ab_channel=CodeCommerce. Tällä hetkellä vain on lisätty email ja password register, mutta tulen lisäämään ainakin googlen vielä! |
| __31.3__ | Auth Flowsin avulla aiemmin suunniteltu flow kirjautuneen ja ei kirjautuneen käyttäjän välillä toteutettu. Tässä dokumentaatio: https://reactnavigation.org/docs/auth-flow/. Tehty kahdella eri tavalla navigatorit (NoAuthNavigation ja AppNavigation), ei kirjautunut käyttäjä käyttää Stack Navia (register ja login) ja mikäli aiemmin luotu useAuth hookin auth on olemassa, käytetään Bottom Tabs navigaatiota, joka on itse sovelluksen päänavigaatio. Tällä hetkellä vielä ei ole toteutettu muita kirjautumisvaihtoehtoja, kun email ja password, mutta mahdollisimman pian lisätään Google. Rekisteröinti ja kirjautuminen täysin alkutekijöissään, eikä tässä vaiheessa ole vielä ulkoasuun kiinnitetty huomiota. Toimintalogiikka kuitenkin vaikuttaa toimivan. |
| __1.4__ | Tehty modulaarisuuden vuoksi useampia eri kansioita jonne sovellusta jaetaan osiin. Muistiinpanoksi itselle, muista laittaa async storage kuntoon, jotta joka kerta ei tarvitse kirjautua järjestelmään uudelleen |
| __2.4__ | Toteutettu navigaation vaihtaminen kirjautumisen ja rekisteröitymisen välillä ja laitettu ulkoasua heiman siistimmäksi. Lisätty FadeIn animaatiokomponentti, jossa hyödynnettiin Reanimated kirjastoa. Navigaation vaihtamisessa TypeScript tyypitysongelmia, joiden ratkaisemiseksi käytin https://reactnavigation.org/docs/typescript/ sekä ChatGPT 4o tekoälymallia. Ongelmana oli, että navigation.navigate("Register") reitti ei ollut oikein tyypitetty. Loin uuden tyypin types.ts tiedostoon ja käytin tätä navigationin luonnissa. Täten virheilmoitus saatiin pois (navigointi toimi siis vaikka tyyppivirhe olikin). Etusivun saavutettavuutta mietitty ihan uudella tavalla. Asetettu ikoneita, buttoni ja tekstilinkki. Keyboard dismiss laitettu TouchableWithoutFeedbackiin ja KeyboardAvoidingView laitettu, jotta keyboard avautuessaan ei peitä sisältöä |
| __7.4__ | Itse pelilogiikkaa aloitettu. Päätin, että sanan mitta valitaan modaalilla ennen pelin alkua. Tällöin voin toimittaa mitan suoraan peliscreenille useRoute ja paramsia käyttäen. Contekstin käyttäminen ei tässä tapauksessa ole järkevää, koska sana haetaan jokaisella pelikerralla uudelleen. <br><br> Huomasin ongelmaksi hitaat siirtymät screenien yms välillä. Tämän vuoksi loinkin universaalin activityindicator komponentin, jotta käyttäjät näkee milloin ollaan siirtymässä latausta vaativaan kohtaan. <br><br> Huomasin myös ongelmia aiemmin valitsemani tab (bottom tabs) navigaation kanssa. Kuten aiemmin tullut sanotuksi, bottom tabsit tulivat vasta käyttöön, kun oltiin kirjauduttu. Kuitenkin haluan, että peli alkaisi nappia painamalla, eikä bottom tabista ja näiden yhdistäminen vaatisi lisätekemistä. Löysin kuitenkin ohjeen tähän https://reactnavigation.org/docs/nesting-navigators/, mutta päätin kuitenkin tehdä stack navigaation myös tästä aiemmin bottom tabseina olleesta navigaatiosta yksinkertaisen logiikan säilyttämiseksi. |
| __9.4__ | Päivä alkoi ongelmalla, joka ilmeisesti on hyvin tyypillinen TypeScriptille. Expo Go:n käynnistäminen ilmoitti, että käytössä ei ole asyncstoragea ja antoi ohjeet, miten se voidaan laittaa. Typescript ei jostain syystä kuitenkaan huolinut tätä ohjetta, mikä vuoksi aloin Googlailla ongelmaa. Löysin vastauksen täältä: https://stackoverflow.com/questions/76914913/cannot-import-getreactnativepersistence-in-firebase10-1-0, jossa kerrottiin, että tsconfigia muuttamalla ongelma voitaisiin ratkaista. Sen avulla sain asyncin toimimaan, mutta nyt kirjatuessa asyncin avulla, kirjautumisscreeni flashaa pikaisesti ennen kun käyttäjä pääsee itse appiin sisään. Käytin ratkaisuna expon SplashScreenia, jolla LoginScreeni piilotataan alussa. Tämän lisäksi lisäsin authcontextiin loading tilan, joka näyttää milloin kirjautumista haetaan. Tätä käytetään nyt myös App.tsx tasolla, jolloin kirjautumista ladatessa näytetään Loading custom komponentti (joka olisi tarkoitus animoida lähiaikoina näyttämään entistä paremmalta). <br><br> Laitettu myös nyt Firestore DB toimimaan. Ei suurempia ongelmia vielä tässä vaiheessa sen suhteen, mutta päätin lisätä nyt samalla rekisteröitymiseen usernamen, joka tulee kanssa tallentaa firebaseen. Nyt samaan dociin tallennetaan email, username sekä pelin tiedot. En ole varma onko tämä hyvä valinta, mutta tutkin asiaa ja tällä ainakin mahdollistetaan mahdollisimman yksinkertainen datan hakeminen, sillä kaikki on samassa paikassa. Palaan tähän arkkitehtuuriin kuitenkin vielä. Tutkin myös firestoren merge: true mahdollisuutta ja päätin jättää sen varmuuden vuoksi päälle, sillä siitä ei ilmeisemmin ole haittaakaan. Luulen, kuitenkin, että sille ei välttämättä ole tarvetta, sillä pelaajan tilastot alustetaan registerin yhteydessä, mutta jos kuitenkin tulen lisäämään jotain kenttiä jälkikäteen, jätän mergen päälle, jotta tietoja ei ylikirjoiteta tms. https://stackoverflow.com/questions/46597327/difference-between-firestore-set-with-merge-true-and-update |
| __15.4__ | Toteutin nyt StatsContextin, jota käytetään kun käyttäjä on kirjautunut (AppNavigator). Toteutin Contextin samalla tavalla kun aiemman AuthContextin. Tässä huomasin, että AuthContext ei ole luotu täysin modulaarisesti. En kuitenkaan sitä lähtenyt vielä muuttamaan, mutta tein uuden contextin siten, että logiikka ja contextin olemassaolon tarkistaminen ovat omissa hookeissaan. Näiden lisäski muotoilin GameBoardin koodia järkevämpään muotoon (resultien tallennuksen suhteen) ja erotin logikaan pelin aikana ja pelin päätyttyä eri useEffecteihin. Myös kutsun nyt statsien päivitystä suoraan pelin jälkeen, jotta käyttäjä kykenee saamaan statseja tarkastellessaan oikean kuvan siitä, missä mennään eikä hakulogiikkaa tarvise toteuttaa statsScreen komponentissa. Huomasin, että käyttäjän pisteet voivat useamman häviön jälkeen mennä negatiivisiksi. Pitää jossain vaiheessa tehdä logiikka, jossa haetaan pistemäärä ja laittaa siten, että alle nollan ei voida mennä.<br><br>
Mietin myös, miten on parasta toteuttaa getDoc haku. Itsellä ei ole sellaista todella kriittistä reaaliaikasta tietoa, minkä vuoksi en laittanut onSnapshot listeneriä vaan toteutin tietojen hakemisen normaalilla getDoc haulla tämän dokumentaation mukaisesti: https://firebase.google.com/docs/firestore/query-data/get-data.
| __22.4__ | Nyt kun itse logiikka oli toteutettu, on mahdollista aloittaa jo tuotoksen paranteleminen. Mietin, miten voisin järkevästi käyttää expon kirjastoja ja löysin expon image pickerin, jonka avulla päätin toteuttaa logiikan, jossa käyttäjän on mahdollista asettaa itselleen profiilikuva. https://docs.expo.dev/versions/latest/sdk/imagepicker/. Huomasin ongelman toteuttaessani updateProfiilia, jossa käyttäjän username ei suoraan päivity palatessaan HomeScreenille. Tämä johtui siitä, että käytin navigation.goBack, joka ei uudelleen renderöinyt komponenttia. Nyt lisäsin siirtymän navigation.navigate("Home", { refresh: true }); tavalla, ja tässä kanssa on tärkeää huomata, että komponentti renderöidään uudelleen refreshin ollessa true. Nyt muutokset näkyy käyttäjälle heti. Lisäsin myös uuden komponentin, jossa on tervehdys sekä käyttäjän profiilikuva jota painamalla voidaan navigoida profiiliscreeniin. Oletuksena käyttäjän profiilikuva on assets kansioon laitettu placeholder profiilikuva. Tämän käyttäminen vaati kanssa require() funkiota. Avun löysin täältä https://reactnative.dev/docs/images.
| __23.4__ | Tarkoituksena on laittaa nyt itse peli parempaan kuntoon, sellaiseksi, miten se on ymmärrettävä. Itse värilogiikkaan tarvitsin apua tekoälyltä ja tältä videolta https://www.youtube.com/watch?v=cSt5WG53OJA&list=PL4cUxeGkcC9gXdVXVJBmHpSI7zCEcjLUX&index=6&ab_channel=NetNinja, sillä en itse millään ymmärtänyt, miten for loopit olisi pitänyt muotoilla, jotta oikea väri saataisiin aina oikealle paikalle. Tulin toteuttaneeksi logiikan for loopeilla yksinkertaisuuden vuoksi ja niitä on kaksi kappaletta. Nyt erityisesti kun etsitään "presenttejä" tulee myös tarkistaa, jos sanassa on esimerkiksi kaksi t kirjainta, joista toinen on oikealla paikalla ja targetissa ei ollenkaan t kirjaimia, tällöin näytetään absent. Päädyin siis toteuttamaan kaksi kappaletta for looppeja, joista ensimmäinen on erittäin yksinkertainen ja tarkastaa onko kirjain paikalla [i] sama molemmissa sanoissa. Jos on merkataan kirjain käytetyksi ja "correct" iksi. Toinen for looppi tarkistaa, löytyykö kirjain sanasta, mutta jos se on jo käytetty, merkitään se "absent". Jos kirjain löytyy annetaan sille "present" ja jos ei niin sitten "absent".<br><br>Huomasin myös ongelman käyttämäni keyboard inputin kanssa. Jos suinkin aika riittää, teen itse alapuolelle oman näppäimistön, jotta keyboardin kanssa ei tarvise temppuilla. Tällä hetkellä jos keyboardista painaa enteriä, se sulkee keyboardin, mitä ei pitäisi käydä. Koitan kuitnekin ehtiä laittamaan kokonaan uuden näppäimistökomponentin, joka kanssa helpottaa peliä, sillä se kanssa käyttää värikoodeja.|
| __24.4__ | Päivä alkoi errorilla. Huomasin, että käyttäjä kuka on lähettänyt arvauksen, tulee error ja sovellus sanoi, että "Warning: Each child in a list should have a unique "key" prop." Laitoin keyn mappiin ja sitten myös showBg funktiolle. Aloin myös kehittämään sovellusta hieman visuaalisesti eteenpäin lisäämällä animaatioita => https://docs.expo.dev/versions/latest/sdk/lottie/. Tein vielä yhden komponentin, joka näyttää kävijälle win ja loss modaalissa ja sitten navigoi takaisin homeen. Ongelmia oli tämän kanssa sillä komponenttiin päästiin takaisin "swaippaamalla" vasemmalle kotinäytöltä. Tämän ratkaisin laittamalla navigateen .reset määrittelyn, joten takaisin meneminen ei enää onnistu. Lisäsin myös wordServiceen definitionin hakemisen, jonka avulla voidaan näyttää sanan määritelmä mikäli sellainen on.<br><br>Lisäksi kirjoitin Firestoreen security rulesit seuraamalla tätä esimerkkiä: https://firebase.google.com/docs/firestore/security/rules-conditions. Tein tämän ehkä hieman typerästi koska publishasin joka kerta uudet rulesit ja testasin niitä vasta sitten, mutta sain kuitenkin roolit siten, että kirjautunut käyttäjä näkee muiden käyttäjien username, kuva ja pelitiedot. Käyttäjä itse voi muokata omia tietojaan, kun usernamea, mutta ei pelitietoja. Pelien historia on piilotettu muilta ja vain käyttäjä itse kykenee näkemään /games/ reitin, ei muokkamaan, mutta luomaan. Ongelmia tässä oli useita. Aluksi unohdin kokonaan, että käyttäjien tulee kyetä rekisteröitymään. Korjasin uuden säännön ja sitten huomasin, että käyttäjät eivät näe toistensa suorituksia. Laitoin julkiseksi, mutta sitten huomasin, että minulla oli docseihin tallennettu kenttä sposti, jostain syystä, jonka otin pois ja nyt kaikki pitäisi olla vähintäänkin melko tietoturvallisia. Tämä oli hyvää harjoitusta minulle ja koen ongelmien jälkeen saaneeni kuvan siitä, miten jatkossa tulisi toimia.|
| __27.4__ | Appia lähdetty alustavasti koristelemaan ja teemaa muuttamaan. Seuransin tätä ohjetta teeman kustomoimiseksi josta lyösin, mitä kaikkea teeman custom teeman avulla voidaan toteuttaa: https://callstack.github.io/react-native-paper/docs/guides/theming/. Fonttien saamisessa oli ongelmaa. Käytin näitä avukseni: https://callstack.github.io/react-native-paper/docs/guides/fonts sekä https://docs.expo.dev/develop/user-interface/fonts/. En aluksi hoksannut, mutta kun muutin defult themeä, piti fontit laittaa hieman erilailla mitä, silloin, kun valmis teema ei ole pohjana. |
| __29.4__ | Appiin tehty uusi screeni instructionsille. Tässä ei ollut suurta ongelmaa. Ainoastaan jouduin lisäämään stackiin uuden screenin ja tyyppeihin tein muutoksia |
| __30.4__ | Tein pari uutta komponenttia. Ensimmäinen on yksinkertainen "goBack"-komponentti, jota klikkaamalla käyttäjä menee takaisin päin. Toinen komponentti on puolestaan animaatio, joka näyttää pointsien kehittymisen. Käytin tässä kirjastoa: https://www.npmjs.com/package/react-native-animated-numbers, jolla yksinkertaisen animaation toteuttaminen oli helppoa. Komponenttiä käytetään tästä lähtien instructionissa näyttämään pointsien lisääntyminen ja pelin jälkeen tulleessa modaalissa oman points varainnon näyttämäiseen. Korjasin nyt aiemmin esiintyneen bugin pelinäytössä sillä vaikuttaa siltä, että minulla ei riitä aika custom keyboardin tekemiselle (guessServicessä on kaikki edellytykset sille jo tehty ei siellä tallennetaan mappi jossa jokaisella keyllä eli characterilla on omat arvot "absent" jne.) jonka ratkaisin lukemalla dokmentaatiota. Laitoin TextInputille submitBehavior="submit" joka ratkaisi ongelman: https://reactnative.dev/docs/textinput#submitbehavior. |
| __1.5__ | Tämän päivän tarkoituksena on tehdä statistiikka haut. Haluan toteuttaa kaksi komponenttia, toinen näyttää pelaajan omat statistiikat ja toinen globaalin leaderboardin 20 parasta pelaajaa. Komponenttien vaihtamisen välillä käytän react native paperin segmented buttons komponenttia: https://callstack.github.io/react-native-paper/docs/components/SegmentedButtons/. Aloin tekemään stats komponenttia käyttäjän tilastojen näyttämiseksi ja kokeilin ensin victory-nativea. Tein Pie Charttia ja ihmettelin, miksi en saa näkymään labeleita. Löysin reddit postauksen 9kk sitten jossa sanottiin, että he ovat "working on it": https://www.reddit.com/r/reactnative/comments/1ev7mua/help_in_displaying_labels_in_pie_chart_using/, eikä vieläkään näytä olevan, joten teen omat legendit Pie Chartille. |
| __3.5__ | Päiväni alkoi tänään suurella korjauksella, sillä Expo SDK päivitys 52 -> 53 oli tullut pakolliseksi. En meinannut millään saada mitään toimimaan jatkuvien konfliktien takia. Kuitenkin konfliktien selvittämisen jälkeen huomasin, että sain seuraavanlaisen virheviestin: "Error: Component auth has not been registered yet, js engine: hermes". Löysin stackoverflowsta ratkaisun: https://stackoverflow.com/questions/79602687/react-native-expo-firebase-auth-component-auth-has-not-been-registered-yet/79603601#79603601, jonka perusteella loin uuden metro.config.js tiedoston, jolla tämän firebasen auth ongelma ratkesi. Tässä kesti liian kauan ja itseltäni meni varmaan noin 4-5h, jotta kaikki ongelmat saatiin ratkeamaan. Tämän jälkeen aloin toteuttamaan statistiikkanäyttöä. Jouduin vaihtamaan victory-native kirjaston toiseen, sillä se aiheutti konflikteja muiden riippuvuuksien kanssa. Nyt siis käytän: https://www.npmjs.com/package/react-native-chart-kit, jolla rakensin yksinkertaisen pie-chartin. Sain omituista error viestiä jatkuvasti jossa koodissa itsessään virhettä ei näkynyt, mutta appi valitti "invalid numberista". Tämä oli omituista enkä netistä löytänyt siihen suoraa vastausta, joten aloin kokeilemaan. Huomasin, että data-arvojen mappaaminen eikä listana esittäminen onnistu, vaan jokaisella tarvitsee olla oma muuttujansa. Koodi näyttää rakenteeltaan siis nyt typerältä, mutta virhe vältetään. Tämän vuoksi olisin aluksi halunnut käyttää parempaa kirjastoa statistiikan näyttämiseen (victory), mutta expon päivityksen myötä tämä ei ole enää mahdollista. |
| __4.5__ | Päivän tavoitteena on lähteä laittamaan appia kokonaisuudessaan kuntoon. Ainoa screen, joka vaatii tässä vaiheessa suurta huomiota on statsScreen ja sieltä erityisesti playerstats komponentti. Päätin poistaa PieChartin ja tehdä sen tilalle itse korttikomponentteja, jotta statsien katsominen ei olisi niin "rankkaa". Laitoin myös tekemääni fade in animaatioon delay mahdollisuuden, jonka avulla voidaan toteuttaa statistiikan näyttäminen paremmin. Tässä dokumentaatio withDelay https://docs.swmansion.com/react-native-reanimated/docs/animations/withDelay, jolla on mahdollista tämä delay toteuttaa. <br><br> Aloitan myös korjaamaan modulaarisuutta mahdollisuuksien mukaan. En kaikkia kehittämistäni ole tehnyt tarpeeksi modulaarisesti, jotta se olisi järkevää ja luettavaa, joten teen sen nyt. Samalla siistin koodia, otan pois turhia importteja ja muuta turhaa jos vain löydän.